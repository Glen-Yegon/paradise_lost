"use strict";const fs=require("graceful-fs"),path=require("path"),copySync=require("../copy").copySync,removeSync=require("../remove").removeSync,mkdirpSync=require("../mkdirs").mkdirpSync,stat=require("../util/stat");function moveSync(e,r,t){const n=(t=t||{}).overwrite||t.clobber||!1,{srcStat:c,isChangingCase:o=!1}=stat.checkPathsSync(e,r,"move",t);return stat.checkParentPathsSync(e,c,r,"move"),isParentRoot(r)||mkdirpSync(path.dirname(r)),doRename(e,r,n,o)}function isParentRoot(e){const r=path.dirname(e);return path.parse(r).root===r}function doRename(e,r,t,n){if(n)return rename(e,r,t);if(t)return removeSync(r),rename(e,r,t);if(fs.existsSync(r))throw new Error("dest already exists.");return rename(e,r,t)}function rename(e,r,t){try{fs.renameSync(e,r)}catch(n){if("EXDEV"!==n.code)throw n;return moveAcrossDevice(e,r,t)}}function moveAcrossDevice(e,r,t){return copySync(e,r,{overwrite:t,errorOnExist:!0,preserveTimestamps:!0}),removeSync(e)}module.exports=moveSync;