"use strict";const u=require("universalify").fromPromise,path=require("path"),fs=require("../fs"),mkdir=require("../mkdirs"),{pathExists:pathExists}=require("../path-exists"),{areIdentical:areIdentical}=require("../util/stat");async function createLink(t,e){let a,r;try{a=await fs.lstat(e)}catch{}try{r=await fs.lstat(t)}catch(t){throw t.message=t.message.replace("lstat","ensureLink"),t}if(a&&areIdentical(r,a))return;const s=path.dirname(e);await pathExists(s)||await mkdir.mkdirs(s),await fs.link(t,e)}function createLinkSync(t,e){let a;try{a=fs.lstatSync(e)}catch{}try{const e=fs.lstatSync(t);if(a&&areIdentical(e,a))return}catch(t){throw t.message=t.message.replace("lstat","ensureLink"),t}const r=path.dirname(e);return fs.existsSync(r)||mkdir.mkdirsSync(r),fs.linkSync(t,e)}module.exports={createLink:u(createLink),createLinkSync:createLinkSync};