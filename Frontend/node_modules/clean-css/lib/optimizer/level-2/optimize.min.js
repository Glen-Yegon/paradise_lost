var mergeAdjacent=require("./merge-adjacent"),mergeMediaQueries=require("./merge-media-queries"),mergeNonAdjacentByBody=require("./merge-non-adjacent-by-body"),mergeNonAdjacentBySelector=require("./merge-non-adjacent-by-selector"),reduceNonAdjacent=require("./reduce-non-adjacent"),removeDuplicateFontAtRules=require("./remove-duplicate-font-at-rules"),removeDuplicateMediaQueries=require("./remove-duplicate-media-queries"),removeDuplicates=require("./remove-duplicates"),removeUnusedAtRules=require("./remove-unused-at-rules"),restructure=require("./restructure"),optimizeProperties=require("./properties/optimize"),OptimizationLevel=require("../../options/optimization-level").OptimizationLevel,Token=require("../../tokenizer/token");function removeEmpty(e){for(var r=0,t=e.length;r<t;r++){var i=e[r],o=!1;switch(i[0]){case Token.RULE:o=0===i[1].length||0===i[2].length;break;case Token.NESTED_BLOCK:removeEmpty(i[2]),o=0===i[2].length;break;case Token.AT_RULE:o=0===i[1].length;break;case Token.AT_RULE_BLOCK:o=0===i[2].length}o&&(e.splice(r,1),r--,t--)}}function recursivelyOptimizeBlocks(e,r){for(var t=0,i=e.length;t<i;t++){var o=e[t];if(o[0]==Token.NESTED_BLOCK){var n=/@(-moz-|-o-|-webkit-)?keyframes/.test(o[1][0][1]);level2Optimize(o[2],r,!n)}}}function recursivelyOptimizeProperties(e,r){for(var t=0,i=e.length;t<i;t++){var o=e[t];switch(o[0]){case Token.RULE:optimizeProperties(o[2],!0,!0,r);break;case Token.NESTED_BLOCK:recursivelyOptimizeProperties(o[2],r)}}}function level2Optimize(e,r,t){var i,o,n=r.options.level[OptimizationLevel.Two],u=r.options.plugins.level2Block;if(recursivelyOptimizeBlocks(e,r),recursivelyOptimizeProperties(e,r),n.removeDuplicateRules&&removeDuplicates(e,r),n.mergeAdjacentRules&&mergeAdjacent(e,r),n.reduceNonAdjacentRules&&reduceNonAdjacent(e,r),n.mergeNonAdjacentRules&&"body"!=n.mergeNonAdjacentRules&&mergeNonAdjacentBySelector(e,r),n.mergeNonAdjacentRules&&"selector"!=n.mergeNonAdjacentRules&&mergeNonAdjacentByBody(e,r),n.restructureRules&&n.mergeAdjacentRules&&t&&(restructure(e,r),mergeAdjacent(e,r)),n.restructureRules&&!n.mergeAdjacentRules&&t&&restructure(e,r),n.removeDuplicateFontRules&&removeDuplicateFontAtRules(e,r),n.removeDuplicateMediaBlocks&&removeDuplicateMediaQueries(e,r),n.removeUnusedAtRules&&removeUnusedAtRules(e,r),n.mergeMedia)for(o=(i=mergeMediaQueries(e,r)).length-1;o>=0;o--)level2Optimize(i[o][2],r,!1);for(o=0;o<u.length;o++)u[o](e);return n.removeEmpty&&removeEmpty(e),e}module.exports=level2Optimize;