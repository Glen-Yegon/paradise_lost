var shortenHex=require("./color/shorten-hex"),shortenHsl=require("./color/shorten-hsl"),shortenRgb=require("./color/shorten-rgb"),split=require("../../../utils/split"),ANY_COLOR_FUNCTION_PATTERN=/(rgb|rgba|hsl|hsla)\(([^()]+)\)/gi,COLOR_PREFIX_PATTERN=/#|rgb|hsl/gi,HEX_LONG_PATTERN=/(^|[^='"])#([0-9a-f]{6})/gi,HEX_SHORT_PATTERN=/(^|[^='"])#([0-9a-f]{3})/gi,HEX_VALUE_PATTERN=/[0-9a-f]/i,HSL_PATTERN=/hsl\((-?\d+),(-?\d+)%?,(-?\d+)%?\)/gi,RGBA_HSLA_PATTERN=/(rgb|hsl)a?\((-?\d+),(-?\d+%?),(-?\d+%?),(0*[1-9]+[0-9]*(\.?\d*)?)\)/gi,RGB_PATTERN=/rgb\((-?\d+),(-?\d+),(-?\d+)\)/gi,TRANSPARENT_FUNCTION_PATTERN=/(?:rgba|hsla)\(0,0%?,0%?,0\)/g,plugin={level1:{value:function(e,r,n){return n.compatibility.properties.colors?r.match(COLOR_PREFIX_PATTERN)?(r=r.replace(RGBA_HSLA_PATTERN,function(e,r,n,t,o,T){return parseInt(T)>=1?r+"("+[n,t,o].join(",")+")":e}).replace(RGB_PATTERN,function(e,r,n,t){return shortenRgb(r,n,t)}).replace(HSL_PATTERN,function(e,r,n,t){return shortenHsl(r,n,t)}).replace(HEX_LONG_PATTERN,function(e,r,n,t,o){var T=o[t+e.length];return T&&HEX_VALUE_PATTERN.test(T)?e:n[0]==n[1]&&n[2]==n[3]&&n[4]==n[5]?(r+"#"+n[0]+n[2]+n[4]).toLowerCase():(r+"#"+n).toLowerCase()}).replace(HEX_SHORT_PATTERN,function(e,r,n){return r+"#"+n.toLowerCase()}).replace(ANY_COLOR_FUNCTION_PATTERN,function(e,r,n){var t=n.split(","),o=r&&r.toLowerCase();return"hsl"==o&&3==t.length||"hsla"==o&&4==t.length||"rgb"==o&&3===t.length&&n.indexOf("%")>0||"rgba"==o&&4==t.length&&t[0].indexOf("%")>0?(-1==t[1].indexOf("%")&&(t[1]+="%"),-1==t[2].indexOf("%")&&(t[2]+="%"),r+"("+t.join(",")+")"):e}),n.compatibility.colors.opacity&&-1==e.indexOf("background")&&(r=r.replace(TRANSPARENT_FUNCTION_PATTERN,function(e){return split(r,",").pop().indexOf("gradient(")>-1?e:"transparent"})),shortenHex(r)):shortenHex(r):r}}};module.exports=plugin;