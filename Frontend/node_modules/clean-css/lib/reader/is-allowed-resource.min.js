var path=require("path"),url=require("url"),isRemoteResource=require("../utils/is-remote-resource"),hasProtocol=require("../utils/has-protocol"),HTTP_PROTOCOL="http:";function isAllowedResource(e,r,o){var l,s,t,u,i,R,a=!r;if(0===o.length)return!1;for(r&&!hasProtocol(e)&&(e=HTTP_PROTOCOL+e),l=r?url.parse(e).host:e,s=r?e:path.resolve(e),R=0;R<o.length;R++)u="!"==(t=o[R])[0],i=t.substring(1),a=u&&r&&isRemoteRule(i)?a&&!isAllowedResource(e,!0,[i]):!u||r||isRemoteRule(i)?u?a&&!0:"all"==t||(r&&"local"==t?a||!1:!(!r||"remote"!=t)||!(!r&&"remote"==t)&&(!r&&"local"==t||(t===l||(t===e||(!(!r||0!==s.indexOf(t))||(!r&&0===s.indexOf(path.resolve(t))||r!=isRemoteRule(i)&&(a&&!0))))))):a&&!isAllowedResource(e,!1,[i]);return a}function isRemoteRule(e){return isRemoteResource(e)||url.parse(HTTP_PROTOCOL+"//"+e).host==e}module.exports=isAllowedResource;